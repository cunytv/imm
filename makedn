#!/bin/bash

DN_DATE=$(date +%Y-%m%d)

PROCESS_DIR="/tmp/dn${DN_DATE}"
MEDIA_ID="DN${DN_DATE/-}"

MP4_FILE="http://mpeg.democracynow.org/dn${DN_DATE}-hd.mp4"
SCC_FILE="https://www.democracynow.org/scc/dn${DN_DATE}.scc"

mkdir -p "$PROCESS_DIR"

echo "Downloading Democracy Now SCC"
wget "${SCC_FILE}" -O "${PROCESS_DIR}/${MEDIA_ID}.scc"
echo "Downloading Democracy Now MP4"
wget "${MP4_FILE}" -O "${PROCESS_DIR}/${MEDIA_ID}.mp4"
echo "Running makebroadcast on ${MEDIA_ID}.mp4"
makebroadcast "${PROCESS_DIR}/${MEDIA_ID}.mp4"
uploadomneon "${PROCESS_DIR}/service/${MEDIA_ID}.mov"
echo "Delivering SCC to Omneon"
uploadomneon "${PROCESS_DIR}/${MEDIA_ID}.scc"
