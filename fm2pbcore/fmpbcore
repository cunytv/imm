#!/bin/bash
_usage(){
    cat <<EOF
    fmpbcore
    
    This will call a hard-coded server and filemaker database with an identifier query to return a set of records in PBCore collection format.
    
    Usage:
        fmpbcore IDENTIFIER
EOF
}

FILEMAKER_SERVER="http://10.10.201.50"
DATABASE_NAME="CUNY_TV_archive"
PBCORE_QUERY_LAYOUT="pbcoreform"
SEARCH_FIELD="PBCoreInstantiationIdentifier::instantiationIdentifier"

ID2QUERY="${1}"
SEARCH_URL="${FILEMAKER_SERVER}/fmi/xml/fmresultset.xml?-db=${DATABASE_NAME}&-lay=${PBCORE_QUERY_LAYOUT}&${SEARCH_FIELD}=${ID2QUERY}&-find"

if [[ -n "${ID2QUERY}" ]] ; then
    SCRIPTDIR="$(dirname "${0}")"
    curl -s "${SEARCH_URL}" | xsltproc "${SCRIPTDIR}/fm2pbcore.xsl" -
else
    _usage
    exit 1
fi
